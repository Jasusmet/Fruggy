<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lista de Productos</title>
    <link th:href="@{/css/style.css}" rel="stylesheet"/>
</head>
<body>
<table class="table table-striped mt-3" th:fragment="tablaAdminProductos">
    <thead>
    <tr>
        <th th:text="#{admin.product.id}">ID</th>
        <th th:text="#{admin.product.name}">Nombre</th>
        <th th:text="#{admin.product.description}">Descripción</th>
        <th th:text="#{admin.product.price}">Precio</th>
        <th th:text="#{admin.product.supermarket}">Supermercado</th>
        <th th:text="#{admin.product.category}">Categoría</th>
        <th th:text="#{admin.product.subcategory}">Subcategoría</th>
        <th th:text="#{admin.product.active}">Activo</th>
        <th th:text="#{admin.product.discounts}">Descuentos</th>
        <th th:text="#{admin.product.edit}">Editar</th>
        <th th:text="#{admin.product.delete}">Eliminar</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="producto : ${productos.content}">
        <td th:text="${producto.id}">ID</td>
        <td th:text="${producto.nombreProducto}">Nombre</td>
        <td th:text="${producto.descripcion}">Descripción</td>
        <td>
            <span th:if="${producto.descuentos.size() > 0}">
                <span th:each="descuento : ${producto.descuentos}">
                    <span th:if="${descuento.activo}">
                        <span th:text="${#numbers.formatDecimal(producto.precios[0].valor * (1 - descuento.porcentaje / 100), 1, 2) + ' € (' + descuento.porcentaje + '% de descuento)'}"></span>
                    </span>
                </span>
            </span>
            <span th:if="${producto.descuentos.size() == 0}" th:text="${#numbers.formatDecimal(producto.precios[0].valor, 1, 2) + ' €'}"></span>
        </td>
        <td th:text="${producto.precios[0].supermercado.nombreSuper + ' (' + producto.precios[0].supermercado.municipio + ')'}">Supermercado</td>
        <td th:text="${producto.subcategoria.categoria.tipo}">Categoría</td>
        <td th:text="${producto.subcategoria.tipo}">Subcategoría</td>
        <td th:text="${producto.activo} ? 'Sí' : 'No'">Activo</td>
        <td>
            <a th:href="@{'/admin/productos/descuento/' + ${producto.id}}" class="btn btn-outline-success"
               th:text="#{admin.product.discounts}">Descuentos</a>
        </td>
        <td>
            <a th:href="@{/admin/productos/editar/{id}(id=${producto.id})}" class="btn btn-warning"
               th:text="#{admin.product.edit}">Editar</a>
        </td>
        <td>
            <form th:action="@{/admin/productos/eliminar/{id}(id=${producto.id})}" method="post"
                  onsubmit="return confirm('¿Estás seguro de eliminar este producto?');">
                <input type="submit" class="btn btn-danger" th:value="#{admin.product.delete}"/>
            </form>
        </td>
    </tr>
    </tbody>
</table>
<!-- Paginación -->
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-3">
        <li class="page-item" th:class="${currentPage == 0} ? 'disabled'">
            <a class="page-link" th:href="@{/admin/productos(page=${currentPage - 1}, size=10)}" tabindex="-1">Anterior</a>
        </li>

        <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}" th:class="${i == currentPage} ? 'active'">
            <a class="page-link" th:href="@{/admin/productos(page=${i}, size=10)}" th:text="${i + 1}"></a>
        </li>

        <li class="page-item" th:class="${currentPage == totalPages - 1} ? 'disabled'">
            <a class="page-link" th:href="@{/admin/productos(page=${currentPage + 1}, size=10)}">Siguiente</a>
        </li>
    </ul>
</nav>
</body>
</html>
